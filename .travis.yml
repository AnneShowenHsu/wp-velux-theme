notifications:
  email:
    on_success: never
    on_failure: change

cache:
  directories:
    - node_modules
    - vendor
    - $HOME/.composer/cache
    - $HOME/.wp-cli/cache
    - $HOME/.wp-cli/packages/cache

language:
  - php
  - node_js

branches:
  only:
    - /^v\d.*$/
    - master
    - develop

env:
  global:
    - WP_THEME=velux

before_install:
  - phpenv config-rm xdebug.ini

before_script:
  - curl https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli-nightly.phar > /tmp/wp-cli.phar
  - chmod +x /tmp/wp-cli.phar

script:
  - echo "Deploy only"

before_deploy:
  - mkdir -p /tmp/$WP_THEME
  - rsync -av --exclude-from $TRAVIS_BUILD_DIR/.distignore --delete $TRAVIS_BUILD_DIR/ /tmp/$WP_THEME/
  - cd /tmp
  - zip -rT $TRAVIS_BUILD_DIR/$WP_THEME.zip $WP_THEME/
  - sha256sum -b $TRAVIS_BUILD_DIR/$WP_THEME.zip | awk '{print $1}' | tee $TRAVIS_BUILD_DIR/$WP_THEME.zip.sha256

deploy:
  provider: releases
  api_key:
    secure: bq6iVDJDQ8AN8KlRTZGokhX5TtleAYidPFDzEQnnoIEx//A+xZOgM1jyIlf9EW7Y7prD4f07PYWcoRj4C5vFgxhCalQui0jcHseed6PDTQ9gktjETReFy+yzD8KJWAO/FMr3xFCeO2gp5P77jVPxEwZ6dwNKZGTDfAGtyJjFQqACjebDX/UM+Ed5GsTzPdjaRXjq0f8Hn7gU1uTU/g1SFLy/HZHjsr9WWV0HbJdFcD3hDILMdivHfiWLLssLlfnIopCDwdFiTIvpNvUt0eR8YZzcoONJUEiFQM8V+/80hT4QwYj8/oRdO/5I3pJxepp5v/VZiLx/6eZ4do2kTk4A3nbk1T31t5rhH5TuuYXZPunc2ebPSSMw6x74S3U5Z3UCG4y2JmEKQk8otli0P4Pw6tXVLUckotWwEtOvSYs83hncLBxWae5zDRFMt3QPynPCEtIUXfnGjx01Z7M+bJT3IddR/qyzdiao3itQAJhV9r+W0ZqwwnAuPk6kMNfOBAKAZT83+Y7p4+g3MzodkI8joNluo0kCb7ajOa7yQT3kI5oYQ0vUEcOIXKFmSHuXFnEw/bws9TtHp+V5bSWJRQPnAqnxWumJAn6gqvIYiWeFbKxGYESMXtJI7smrdTWmHxK2fNZYrsdG0vxQWy/IpB0/X+xmhX08N1bTXDY4GedhiSY=
  file:
    - "$TRAVIS_BUILD_DIR/$WP_THEME.zip"
    - "$TRAVIS_BUILD_DIR/$WP_THEME.zip.sha256"
  skip_cleanup: true
  overwrite: true
  on:
    tags: true
    repo: godaddy/wp-velux-theme
